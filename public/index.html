<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR Yoklama - Ana Sayfa</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 2rem; }
    .card { max-width: 720px; padding: 1.5rem; border: 1px solid #ddd; border-radius: 12px; }
    h1 { margin-top: 0; }
    .ok { color: #0a8a0a; font-weight: bold; }
    .row { display: flex; gap: .5rem; margin: 1rem 0; flex-wrap: wrap;}
    input[type="text"] { flex:1; min-width: 220px; padding: .6rem .8rem; border: 1px solid #bbb; border-radius: 8px; }
    button { padding: .6rem 1rem; border: 1px solid #222; background:#222; color:#fff; border-radius: 8px; cursor:pointer; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    img { display:block; margin-top:1rem; border:1px solid #eee; border-radius: 8px; max-width: 256px; }
    small { color:#555 }
    .msg { margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>
  <div class="card">
    <h1>QR Yoklama</h1>
    

    <!-- QR Ã¼retme -->
    <div class="row">
      <input id="qrText" type="text" placeholder="QR iÃ§ine yazÄ±lacak metin (Ã¶rn: DÃœYBS-2025-11-02-1)" />
      <button id="makeQr">QR OluÅŸtur</button>
    </div>
    <small>Ä°pucu: Metne yoklama kodu yaz. Ã–rn: <b>DÃœYBS-2025-11-02-1</b></small>
    <img id="qrImage" alt="QR gÃ¶rÃ¼ntÃ¼sÃ¼ burada belirecek" />
<!-- KullanÄ±cÄ± kod girsin -->
<input id="codeInput" placeholder="Ã–rn: YBS311-01" />
<button id="makeQr">QR OluÅŸtur</button>
<br><br>
<img id="qrImg" alt="QR" style="max-width:240px;">

<script>
document.getElementById('makeQr').addEventListener('click', () => {
  const c = (document.getElementById('codeInput').value || '').trim();
  if (!c) { alert('Kod girin'); return; }
  // DoÄŸru uÃ§ nokta: /qr?code=...
  document.getElementById('qrImg').src = `/qr?code=${encodeURIComponent(c)}`;
});
</script>


    <hr/>

    <!-- Yoklama verme -->
    <h3>Yoklamaya KatÄ±l</h3>
    <div class="row">
      <input id="codeInput" type="text" placeholder="Yoklama kodu (Ã¶rn: DÃœYBS-2025-11-02-1)" />
    </div>
    <div class="row">
      <input id="nameInput" type="text" placeholder="Ad Soyad (isteÄŸe baÄŸlÄ±)" />
      <input id="noInput" type="text" placeholder="Ã–ÄŸrenci No (isteÄŸe baÄŸlÄ±)" />
    </div>
    <div class="row">
      <button id="checkInBtn">YoklamayÄ± Ver</button>
    </div>
    <div id="msg" class="msg"></div>

    <p>
      <a href="/scan">ğŸ“· QR TarayÄ±cÄ±</a> |
      <a href="/admin">ğŸ› ï¸ YÃ¶netici Paneli</a> |
      <a href="/ping" target="_blank">/ping</a>
    </p>
  </div>

  <script>
    // ---- QR oluÅŸturma
    const qrInput = document.getElementById('qrText');
    const makeQrBtn = document.getElementById('makeQr');
    const img = document.getElementById('qrImage');

    function updateQrBtn(){
      makeQrBtn.disabled = !qrInput.value.trim();
    }
    updateQrBtn();
    qrInput.addEventListener('input', updateQrBtn);

    makeQrBtn.addEventListener('click', () => {
      const val = qrInput.value.trim();
      if (!val) return;
      // Sunucudaki /qr endpoint'inden PNG al
      const url = '/qr?t=' + encodeURIComponent(val);
      img.src = url;
    });

    // ---- Yoklama verme
    const codeInput = document.getElementById('codeInput');
    const nameInput = document.getElementById('nameInput');
    const noInput   = document.getElementById('noInput');
    const checkInBtn = document.getElementById('checkInBtn');
    const msg = document.getElementById('msg');

    checkInBtn.addEventListener('click', async () => {
      const code = codeInput.value.trim();
      const name = nameInput.value.trim();
      const studentNo = noInput.value.trim();
      if (!code) { msg.textContent = 'LÃ¼tfen yoklama kodu girin.'; return; }

      msg.textContent = 'GÃ¶nderiliyor...';
      try {
        const res = await fetch('/api/check-in', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ code, name, studentNo })
        });
        const data = await res.json();
        if (data.status === 'success') {
          msg.textContent = 'âœ… Yoklama alÄ±ndÄ± (bu cihaz iÃ§in 1 kez).';
        } else if (data.status === 'already_checked') {
          msg.textContent = 'âš ï¸ Bu cihaz bu yoklamayÄ± zaten vermiÅŸ.';
        } else {
          msg.textContent = 'âŒ Hata: ' + (data.message || 'Bilinmeyen hata');
        }
      } catch (e) {
        msg.textContent = 'âŒ Sunucu hatasÄ± veya baÄŸlantÄ± sorunu';
      }
    });
  </script>
notepad C:\Users\HP\qr-yoklama\public\index.html

</body>
</html>
